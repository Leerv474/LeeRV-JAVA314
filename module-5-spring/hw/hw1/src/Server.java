import javax.management.MBeanServerConnection;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.InetAddress;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Random;
import java.net.UnknownHostException;

public class Server extends Thread {
    private static final int PORT = 5555;
    private final String MSG = "Client '%d' response:\n\t";
    private final String CONN = "Client '%d' closed connection";
    String[] quotes = {
            "Будь собой; все остальные роли уже заняты. — Оскар Уайльд",
            "Чем меньше человек знает, тем громче он говорит. — Михаил Ломоносов",
            "Чтобы победить врага, надо сначала научиться управлять самим собой. — Сунь Цзы",
            "Никогда не откладывай на завтра то, что можешь сделать сегодня. — Бенжамин Франклин",
            "Люди забывают, что ты сказал, люди забывают, что ты сделал, но люди никогда не забудут, как ты заставил их себя чувствовать. — Майя Анджелоу",
            "Жизнь — это то, что происходит, пока мы строим планы. — Джон Леннон",
            "Человек, который никогда не ошибается, никогда не пробует ничего нового. — Альберт Эйнштейн",
            "Все, что нас не убивает, делает нас сильнее. — Фридрих Ницше",
            "Будь изменой, которую хочешь увидеть в мире. — Махатма Ганди",
            "Счастье — это не что-то готовое. Оно приходит от ваших собственных действий. — Далай Лама",
            "На свете нет ничего более ценного, чем свободное время. — Даниил Гранин",
            "Только тот, кто движется вперед, может идти к успеху. — Лев Толстой",
            "Любовь — это когда счастье другого человека важнее твоего собственного. — Х. Джексон Браун",
            "Лучше быть одиноким, чем в плохой компании. — Джордж Вашингтон",
            "В жизни не бывает случайностей, все предопределено. — Григорий Перельман",
            "Секрет успеха в том, чтобы начать действовать. — Марк Твен",
            "Учиться — это как плыть против течения: если не идешь вперед, то откатишься назад. — Лао Цзы",
            "Не бойся перемен. Ты можешь потерять что-то хорошее, но получишь что-то лучшее. — Джим Рон",
            "Кто ищет, тот всегда найдет. — Японская пословица",
            "Секрет счастья в том, чтобы уметь наслаждаться каждым моментом. — Джон Стюарт Милль",
            "Тот, кто хочет быть счастливым, должен стремиться быть добрым. — Леонардо да Винчи",
            "Не позволяй мелочам разрушить твоё счастье. — Марк Твен",
            "Успех — это когда ты можешь достичь своих целей и сохранить внутреннее спокойствие. — Наполеон Хилл",
            "Счастье — это не конечная цель, а способ путешествия. — Арнольд Палмер",
            "Мудрость приходит с опытом. — Вольтер",
            "Нет ничего невозможного для того, кто верит в себя. — Нельсон Мандела",
            "Мы — это то, что мы делаем постоянно. Поэтому совершенство — это не действие, а привычка. — Аристотель",
            "Самый простой способ начать — это перестать говорить и начать делать. — Уолт Дисней",
            "Только в темноте можно увидеть звезды. — Мартин Лютер Кинг",
            "Верь в себя и все станет возможным. — Кристиан Д. Ларсен",
            "Нельзя изменить направление ветра, но можно отрегулировать свои паруса. — Джим Рон",
            "Будущее принадлежит тем, кто верит в свои мечты. — Элеонор Рузвельт",
            "Жизнь — это не ожидание, пока буря пройдет, а умение танцевать под дождем. — Вивиан Грин",
            "Секрет успеха — это начать с того, что нужно сделать, а затем сделать то, что нужно. — Питер Друкер",
            "Не ждите. Время никогда не будет «подходящим». — Наполеон Хилл",
            "Если ты хочешь быть счастливым, будь им. — Лев Толстой",
            "Человек — это то, что он делает. — Махатма Ганди",
            "Каждый день — это новый шанс изменить свою жизнь. — Незвестен",
            "Секрет успеха в том, чтобы делать то, что любишь. — Майкл Джордан",
            "В жизни не бывает ничего случайного. Все имеет свой смысл. — Пауло Коэльо",
            "Отличие успешных людей от неуспешных в том, что успешные люди действуют. — Тони Роббинс",
            "Не бойся изменений, они могут привести к чему-то хорошему. — Стив Джобс",
            "Каждый момент — это новый шанс. — Джек Кэнфилд",
            "Стремись быть не успешным, а ценным. — Альберт Эйнштейн",
            "Лучше верить в чудо, чем в чудо не верить. — Далай Лама",
            "Не останавливайся на достигнутом. — Уинстон Черчилль",
            "Будь собой и не пытайся быть тем, кем ты не являешься. — Джудит Рич Харрис",
            "Чем больше ты отдаешь, тем больше получаешь. — Лао Цзы",
            "Счастье — это не что-то готовое, это результат твоих собственных действий. — Далай Лама",
            "Секрет успеха в том, чтобы начать действовать. — Марк Твен",
            "Живи так, чтобы твои мечты стали реальностью. — Уолт Дисней",
            "Будь изменой, которую ты хочешь видеть в мире. — Махатма Ганди",
            "Будущее зависит от того, что ты делаешь сегодня. — Махатма Ганди",
            "Тот, кто идет медленно, но уверенно, дойдет до своей цели. — Микеланджело",
            "Никогда не поздно стать тем, кем ты мог бы быть. — Джордж Элиот",
            "Не позволяй мелочам разрушать твоё счастье. — Марк Твен",
            "Человек, который никогда не ошибается, никогда не пробует ничего нового. — Альберт Эйнштейн",
            "Успех не окончателен, неудача не фатальна: важно лишь мужество продолжать. — Уинстон Черчилль",
            "Каждый день — это новый шанс изменить свою жизнь. — Неизвестен",
            "Самый простой способ начать — это перестать говорить и начать делать. — Уолт Дисней",
            "Секрет успешного бизнеса в том, чтобы постоянно улучшаться. — Генри Форд",
            "Верь в свои мечты и иди к ним. — Нельсон Мандела",
            "Жизнь — это не ожидание, пока буря пройдет, а умение танцевать под дождем. — Вивиан Грин",
            "Не бойся перемен, они могут привести к чему-то хорошему. — Стив Джобс",
            "Каждый момент — это новый шанс. — Джек Кэнфилд",
            "Секрет успеха в том, чтобы делать то, что любишь. — Майкл Джордан",
            "Будь собой, все остальные роли уже заняты. — Оскар Уайльд",
            "Секрет счастья в том, чтобы уметь наслаждаться каждым моментом. — Джон Стюарт Милль",
            "Успех — это когда ты можешь достичь своих целей и сохранить внутреннее спокойствие. — Наполеон Хилл",
            "Самый простой способ начать — это перестать говорить и начать делать. — Уолт Дисней",
            "Секрет счастья в том, чтобы уметь наслаждаться каждым моментом. — Джон Стюарт Милль",
            "Счастье — это не конечная цель, а способ путешествия. — Арнольд Палмер",
            "Секрет успеха в том, чтобы начать действовать. — Марк Твен",
            "Человек, который никогда не ошибается, никогда не пробует ничего нового. — Альберт Эйнштейн",
            "Секрет успешного бизнеса в том, чтобы постоянно улучшаться. — Генри Форд",
            "Успех не окончателен, неудача не фатальна: важно лишь мужество продолжать. — Уинстон Черчилль",
            "Человек — это то, что он делает. — Махатма Ганди",
            "Каждый день — это новый шанс изменить свою жизнь. — Неизвестен",
            "Тот, кто хочет быть счастливым, должен стремиться быть добрым. — Леонардо да Винчи",
            "Секрет успеха в том, чтобы делать то, что любишь. — Майкл Джордан",
            "Лучше верить в чудо, чем в чудо не верить. — Далай Лама",
            "Счастье — это не что-то готовое, это результат твоих собственных действий. — Далай Лама",
            "Человек, который никогда не ошибается, никогда не пробует ничего нового. — Альберт Эйнштейн",
            "Тот, кто идет медленно, но уверенно, дойдет до своей цели. — Микеланджело",
            "Не останавливайся на достигнутом. — Уинстон Черчилль",
            "Живи так, чтобы твои мечты стали реальностью. — Уолт Дисней",
            "Будущее зависит от того, что ты делаешь сегодня. — Махатма Ганди",
            "Каждый день — это новый шанс изменить свою жизнь. — Неизвестен",
            "Секрет счастья в том, чтобы уметь наслаждаться каждым моментом. — Джон Стюарт Милль",
            "Секрет успеха в том, чтобы начать действовать. — Марк Твен",
            "Счастье — это не конечная цель, а способ путешествия. — Арнольд Палмер",
            "Будь собой; все остальные роли уже заняты. — Оскар Уайльд",
            "Жизнь — это то, что происходит, пока мы строим планы. — Джон Леннон",
            "Не позволяй мелочам разрушить твоё счастье. — Марк Твен"
    };
    private Socket socket;
    private int num;

    public void setSocket(int num, Socket socket) {
        this.num = num;
        this.socket = socket;

        start();
    }

    public void run() {
        try {
            DataInputStream dis = new DataInputStream(socket.getInputStream());
            DataOutputStream dos = new DataOutputStream(socket.getOutputStream());
            String line;
            Random random = new Random();
            while (true) {
                line = dis.readUTF();
                System.out.printf(MSG, num);
                System.out.println(line);
                System.out.println("Sending back...");
                dos.writeUTF(quotes[random.nextInt(100)]);
                dos.flush();
                System.out.println("Random quote has been sent");
                System.out.println();
                if (line.equalsIgnoreCase("No")) {
                    socket.close();
                    System.out.printf(CONN, num);
                    break;
                }
            }
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    public static void main(String[] args) {
        ServerSocket srvSocket = null;
        try {
            try {
                int i = 0;
                InetAddress ia = InetAddress.getByName("localhost");
                srvSocket = new ServerSocket(PORT, 0, ia);
                System.out.println("Server is running");

                while (true) {
                    Socket socket = srvSocket.accept();
                    System.err.println("\n\nClient accepted");
                    new Server().setSocket(i++, socket);
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        } finally {
            try {
                if (srvSocket != null) {
                    srvSocket.close();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

    }
}
